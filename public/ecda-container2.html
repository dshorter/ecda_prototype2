<dom-module id="ecda-container2">

    <link rel="import" href="ecda-frequency.html">
    <link rel="import"
          href="bower_components/iron-flex-layout/iron-flex-layout-classes.html">
    <link rel="import" href="ecda-google-map.html">

    <link rel="import" href="bower_components/iron-meta/iron-meta.html">


    <style include="iron-flex iron-flex-alignment"></style>


    <template>

        <iron-meta key="thisKey"
                   id="thisMeta"
                   value="thisData"></iron-meta>


        <iron-ajax id="myAjax"
                   on-response="handleResponse">
        </iron-ajax>

        <!--   <iron-ajax auto="true"
                      content-type="application/json; charset=utf-8"
                      method="POST"
                      url="http://localhost/edca.api/Login"
                      on-response="handleResponse"
                      handle-as="text">
           </iron-ajax>-->


        <iron-ajax id="canvasAjax" on-response="handleCanvasResponse">

        </iron-ajax>


        <div class="layout horizontal wrap" id="xx1">

            <ecda-frequency id="firstFreq"></ecda-frequency>
            <ecda-frequency jsondata="Frequency Declarative 1"></ecda-frequency>
            <ecda-frequency jsondata="Frequency Declarative 2"></ecda-frequency>
            <ecda-frequency jsondata="Frequency Declarative 3"></ecda-frequency>

        </div>

    </template>
    <script>


        Polymer({
            is: 'ecda-container2',
            ready: function () {

                var user = tempConstants.user;
                var password = tempConstants.password;
                var canvasid = tempConstants.canvasid;

                var jsonRequest = {
                    id: user,
                    password: password,
                    canvasid: canvasid
                };

                logThis('ready ');


                tryAjax(this.$.myAjax, "Login", jsonRequest);


            },

            attached: function () {

                //    this.addHardCoded();

            },
            addHardCoded: function () {
                // injecting component into polymer
                var freq = document.createElement("ecda-frequency");
                var freq1 = document.createElement("ecda-frequency");
                var map = document.createElement("ecda-google-map");

                freq.jsondata = "Frequency Imperative 1";
                freq1.jsondata = "Frequency Imperative 2";
                map.jsondata = "Map Imperative 3";

                Polymer.dom(xx1).appendChild(freq);
                Polymer.dom(xx1).appendChild(freq1)
                Polymer.dom(xx1).appendChild(map);


            },

            handleCanvasResponse: function (response) {

                //  logThis('hello ');

                //  logThis(response.detail.xhr.responseText);

                walk( JSON.parse( response.detail.xhr.responseText  )  )        ;

            },
            handleResponse: function (e, responseX) {


                logThis("e.detail.xhr.responseType  --> " + e.detail.xhr.responseType);


                var responseJson = JSON.parse(e.detail.xhr.responseText);

                if (gUserJson) {

                    gUserJson.User = responseJson;
                    console.log('cont gUser ---->  ' + gUserJson.User);

                    walk(gUserJson, "gUserJson");

                }

                //======================
                var user = gUserJson.User.Email;
                var password = gUserJson.User.PasswordHash;
                var canvasid = tempConstants.canvasid;

                var jsonUser = {
                    id: user,
                    password: password,
                    canvasid: canvasid
                };


                this.$.firstFreq.jsondata = responseJson.UserName;

                tryAjax(this.$.canvasAjax, "Canvas", jsonUser  )        ;

                logThis(this.$.canvasAjax.body);


            }


        });
    </script>

</dom-module>
